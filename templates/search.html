{% extends "base.html" %}

{% block content %}
<div class="search-page">
    <div class="page-header">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        <h1>üîç –ü–æ–∏—Å–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π</h1>
    </div>

    <div class="search-form">
        <form method="GET" action="{{ url_for('search_posts') }}">
            <div class="search-input-group">
                <input type="text" name="q" value="{{ search_query }}" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞..." class="search-input">
                <select name="category">
                    <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    {% for value, label in categories %}
                        <option value="{{ value }}" {% if current_category == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="btn btn-primary">üîç –ù–∞–π—Ç–∏</button>
            </div>
        </form>
    </div>

    {% if search_query %}
    <div class="search-results">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –¥–ª—è "{{ search_query }}"</h3>
        {% if current_category %}
            <p>–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ dict(categories).get(current_category, current_category) }}</p>
        {% endif %}

        <div class="posts-list">
            {% for post in posts.items %}
                <div class="post-card">
                    <h3><a href="{{ url_for('post_detail', post_id=post.id) }}">{{ post.title }}</a></h3>
                    <p class="post-meta">
                        üìç {{ post.category }} ‚Ä¢ {{ post.created_at.strftime('%d.%m.%Y') }}
                        {% if post.price %} ‚Ä¢ üí∞ {{ post.price }}{% endif %}
                        {% if post.author.reviews_count > 0 %}
                        ‚Ä¢ ‚≠ê {{ "%.1f"|format(post.author.average_rating) }} ({{ post.author.reviews_count }})
                        {% endif %}
                    </p>
                    <p>{{ post.content[:150] }}{% if post.content|length > 150 %}...{% endif %}</p>
                    <a href="{{ url_for('post_detail', post_id=post.id) }}" class="read-more">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                </div>
            {% else %}
                <div class="no-results">
                    <p>–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
                    <a href="{{ url_for('posts') }}" class="btn btn-secondary">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</a>
                </div>
            {% endfor %}
        </div>

        {% if posts.pages > 1 %}
        <div class="pagination">
            {% if posts.has_prev %}
                <a href="{{ url_for('search_posts', page=posts.prev_num, q=search_query, category=current_category) }}" class="btn">‚Üê –ù–∞–∑–∞–¥</a>
            {% endif %}

            <span>–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ posts.page }} –∏–∑ {{ posts.pages }}</span>

            {% if posts.has_next %}
                <a href="{{ url_for('search_posts', page=posts.next_num, q=search_query, category=current_category) }}" class="btn">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
            {% endif %}
        </div>
        {% endif %}
    </div>
    {% endif %}

    <div class="quick-actions">
        <a href="{{ url_for('create_post') }}" class="btn btn-primary">üìù –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</a>
        <a href="{{ url_for('posts') }}" class="btn btn-secondary">üìã –í—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</a>
    </div>
</div>
{% endblock %}